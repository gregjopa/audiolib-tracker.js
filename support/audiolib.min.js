this.audioLib=function a(b,c,d,e){function f(a){f.list.push(a)}function i(a){var b=new g(a);return b.subarray=b.subarray||b.slice,b}function k(a,b,c,d){j?j(a,b,{get:function(){return c},enumerable:!!d}):a[b]=c}function l(a){var b=arguments,c=b.length,d,e;for(d=1;d<c;d++)for(e in b[d])b[d].hasOwnProperty(e)&&(a[e]=b[d][e]);return a}function m(a,b,c){var d;for(d in a)(a.hasOwnProperty(d)||c)&&b.call(a,a[d],d);return a}function n(a,b,c){var d,f;if(!c){c=[],d=/^\s*function\s*\w*\s*\(([^\)]+)/.exec(b);if(d)d[1].replace(/[a-z$_0-9]+/ig,function(a){c.push(a)});else for(d=0;d<b.length;d++)c[d]=e(d+2).join("_")}return f=Function("var __q;return function "+a+"("+c.join()+"){var i; if(__q){__q=!__q}else if(this instanceof "+a+")this.__CLASSCONSTRUCTOR.apply(this,arguments);else{__q=!__q;i=new "+a+";i.__CLASSCONSTRUCTOR.apply(i,arguments);return i}};")(),f.prototype=b.prototype,f.prototype.__CLASSCONSTRUCTOR=b,l(f,b),f}function o(a,b){o[a]=b,o._pluginList.push({plugin:b,name:a})}function p(a,b,c){function d(){a.apply(this,c)}this.channelCount=isNaN(b)?this.channelCount:b,this.effects=[],d.prototype=a.prototype;while(b--)this.effects.push(new d)}function q(){}function r(a,b,c,d){this.parameter=a,this.automation=b,this.amount=isNaN(c)?this.amount:c,this.setType(d)}function s(a,b,c,d,e){if(!a.automation){a.automation=[];switch(a.type){case"generator":a.append=s.generatorAppend;break;case"effect":a.append=s.effectAppend;break;case"buffereffect":a.append=s.bufferEffectAppend}}return c=new r(b,c,d,e),a.automation.push(c),c}function t(a,b){var c=a[0].toUpperCase()+a.substr(1).toLowerCase();return t[a]=b,b.decode&&(h.Sampler.prototype["load"+c]=function(b){this.load.apply(this,[t[a].decode(b)].concat([].slice.call(arguments,1)))}),b.encode&&(h.AudioDevice.Recording.prototype["to"+c]=function(b){return t[a].encode({data:this.join(),sampleRate:this.boundTo.sampleRate,channelCount:this.boundTo.channelCount,bytesPerSample:b})}),b}function u(){}function v(a,b,c,d){this.sampleRate=isNaN(a)?this.sampleRate:a,this.threshold=isNaN(b)?this.threshold:b,this.attack=isNaN(c)?this.attack:c,this.release=isNaN(d)?this.release:d,this._amplitude=new h.Amplitude(this.sampleRate,this.attack,this.release)}function w(a,b){var d=this,e=0;d.sampleRate=a,d.resolution=b?c.pow(2,b-1):c.pow(2,7),d.pushSample=function(a){return e=c.floor(a*d.resolution+.5)/d.resolution,e},d.getMix=function(){return e}}function x(a,b,c){var d=this,e=0;d.sampleRate=a,d.scale=b||1,d.gain=isNaN(c)?.5:c,d.pushSample=function(a){return a/=d.scale,e=(1+d.gain)*a-d.gain*a*a*a,e},d.getMix=function(){return e}}function y(a,b,c,d){var e=this;e.sampleRate=a,e.buffer=new i(isNaN(b)?1200:b),e.bufferSize=e.buffer.length,e.feedback=isNaN(c)?e.feedback:c,e.damping=isNaN(d)?e.damping:d,e.invDamping=1-e.damping}function z(a,b,d){function o(){i=h*e.cutoff/e.samplerate,j=1-i/(2*(e.resonance+.5/(1+i))+i-2),k=j*j,l=k+1-2*c.cos(i)*j}var e=this,f=0,g=0,h=c.PI*2,i,j,k,l,m,n;e.cutoff=b?b:2e4,e.resonance=d?d:1,e.samplerate=a,e.pushSample=function(a){if(m!==e.cutoff||n!==e.resonance)o(),m=e.cutoff,n=e.resonance;return f+=(a-g)*l,g+=f,f*=k,g},e.getMix=function(){return g},o()}function A(a,b,c,d,e,f){this.reset.apply(this,arguments)}function B(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.gain=isNaN(b)?this.gain:b}function C(a){var b=new G(a,720.484),d=new G(a,723.431),e=new G(a,1),f=0;this.gain=4,this.master=1,this.sampleRate=a,this.filters=[b,d,e],this.pushSample=function(a){return b.pushSample(a),f=b.getMix(1)*this.gain,f=c.atan(f)+f,f>.4?f=.4:f<-0.4&&(f=-0.4),d.pushSample(f),e.pushSample(d.getMix(0)),f=e.getMix(1)*this.master,f},this.getMix=function(){return f}}function D(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.setParam("kernels",b||new i(1))}function E(a,b,c,d,e,f,g){var i=this;i.sampleRate=a,i.channelCount=isNaN(b)?i.channelCount:b,i.wet=isNaN(c)?i.wet:c,i.dry=isNaN(d)?i.dry:d,i.roomSize=isNaN(e)?i.roomSize:e,i.damping=isNaN(f)?i.damping:f,i.tuning=new E.Tuning(g||i.tuning),i.sample=function(){var a=[],b;for(b=0;b<i.channelCount;b++)a[b]=0;return a}(),i.CFs=function(){var a=[],b=[],c=i.tuning.combCount,d=i.damping*i.tuning.scaleDamping,e=i.roomSize*i.tuning.scaleRoom+i.tuning.offsetRoom,f=i.tuning.combTuning,g,j;for(j=0;j<i.channelCount;j++){for(g=0;g<c;g++)b.push(new h.CombFilter(i.sampleRate,f[g]+j*i.tuning.stereoSpread,e,d));a.push(b),b=[]}return a}(),i.numCFs=i.CFs[0].length,i.APFs=function(){var a=[],b=[],c=i.tuning.allPassCount,d=i.tuning.allPassFeedback,e=i.tuning.allPassTuning,f,g;for(g=0;g<i.channelCount;g++){for(f=0;f<c;f++)b.push(new E.AllPassFilter(i.sampleRate,e[f]+g*i.tuning.stereoSpread,d));a.push(b),b=[]}return a}(),i.numAPFs=i.APFs[0].length}function F(a,b,c){var d=this;d.time=isNaN(b)?d.time:b,d.feedback=isNaN(c)?d.feedback:c,d.reset(a)}function G(a,b,d,e){function o(){h=2*l(c.PI*m(.25,f.cutoff/(f.samplerate*2))),i=m(2*(1-n(f.resonance,.25)),m(2,2/h-h*.5))}var f=this,g=[0,0,0,0],h,i,j,k,l=c.sin,m=c.min,n=c.pow;f.cutoff=isNaN(b)?2e4:b,f.resonance=d?d:.1,f.samplerate=isNaN(a)?44100:a,f.type=e||0,f.pushSample=function(a){if(j!==f.cutoff||k!==f.resonance)o(),j=f.cutoff,k=f.resonance;return g[3]=a-i*g[2],g[0]=g[0]+h*g[2],g[1]=g[3]-g[0],g[2]=h*g[1]+g[2],g[3]=a-i*g[2],g[0]=g[0]+h*g[2],g[1]=g[3]-g[0],g[2]=h*g[1]+g[2],g[f.type]},f.getMix=function(a){return g[a||f.type]}}function H(a,b,d,e){function k(){g=new i(f.sampleRate*.1),h=0;var a,b=g.length;for(a=0;a<b;a++)g[a]=0}var f=this,g,h,j;f.delayTime=b||30,f.depth=d||3,f.freq=e||.1,f.sampleRate=a,f.osc=new O(a,e),f.calcCoeff=k,f.pushSample=function(a){++h>=g.length&&(h=0),g[h]=a,f.osc.generate();var b=f.delayTime+f.osc.getMix()*f.depth;b*=f.sampleRate/1e3,b=h-c.floor(b);while(b<0)b+=g.length;return j=g[b],j},f.getMix=function(){return j},k()}function I(a,b,c){this.sampleRate=isNaN(a)?this.sampleRate:a,this.attack=isNaN(b)?this.attack:b,this.decay=isNaN(c)?this.decay:c}function K(a,b,c,d,e,f,g){this.sampleRate=isNaN(a)?this.sampleRate:a,this.attack=isNaN(b)?this.attack:b,this.decay=isNaN(c)?this.decay:c,this.sustain=isNaN(d)?this.sustain:d,this.release=isNaN(e)?this.release:e,this.sustainTime=isNaN(f)?null:f,this.releaseTime=isNaN(g)?null:g}function L(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.schedule=[],this.reset(b)}function M(a,b,c,d){var e=this,f=0;this.sampleRate=isNaN(a)?this.sampleRate:a,this.stepLength=isNaN(b)?this.stepLength:b,this.steps=c||[1,0],this.attack=isNaN(d)?this.attack:d}function O(a,b){var c=this;c.frequency=isNaN(b)?440:b,c.waveTable=new i(1),c.sampleRate=a,c.waveShapes=c.waveShapes.slice(0)}function P(a,b){var c=this;c.voices=[],c.sampleRate=a,c.pitch=isNaN(b)?440:c.pitch}function Q(){this.reset.apply(this,arguments)}f.list=[];var g=b.Float32Array||e,h=this;h.Float32Array=i;var j=function(){if(d.defineProperty)return d.defineProperty;if(d.prototype.__defineGetter__)return function(a,b,c){c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}}();k(h,"__define",j),k(h,"__defineConst",k),k(h,"__extend",l),k(h,"__enum",m),k(h,"__class",n),k(o,"_pluginList",[],!1),p.prototype={mix:.5,type:"buffereffect",channelCount:2,append:function(a,b,c){var d=this,e=a.length,f,g;b=b||d.channelCount,c=c||a;for(f=0;f<e;f+=b)for(g=0;g<b;g++)d.effects[g].pushSample(a[f+g],0),c[f+g]=d.effects[g].getMix(0)*d.mix+a[f+g]*(1-d.mix);return c},addPreProcessing:function(){var a;for(a=0;a<this.effects.length;a++)this.effects[a].addPreProcessing.apply(this.effects[a],arguments)},removePreProcessing:function(){var a;for(a=0;a<this.effects.length;a++)this.effects[a].removePreProcessing.apply(this.effects[a],arguments)},setParam:function(a,b){var c=this.effects.length,d;for(d=0;d<c;d++)this.effects[d].setParam(a,b)}},f(function(){h.EffectClass.createBufferBased=function a(a){return new h.BufferEffect(this,a,[].slice.call(arguments,1))}}),q.prototype={type:"generator",source:!0,mix:1,generatedBuffer:null,channelCount:1,append:function(a,b,c){var d=a.length,e,f;c=c||a,b=b||this.channelCount;for(e=0;e<d;e+=b){this.generate();for(f=0;f<b;f++)c[e+f]=this.getMix(f)*this.mix+a[e+f]}return c},addPreProcessing:function(a){a.generate=this.generate,this.generate=function(){return a.apply(this,arguments),a.generate.apply(this,arguments)}},removePreProcessing:function(a){var b;while(b=this.generate.generate)if(b===a||!a)this.generate=b,a.generate=null},generateBuffer:function(a,b){this.generatedBuffer=new i(a),this.append(this.generatedBuffer,b||1)},setParam:function(a,b){this[a]=b},generate:function(){},getMix:function(){},reset:function(){}},r.prototype={parameter:"",automation:null,amount:1,type:"modulation",mode:null,setType:function(a){a?(typeof a=="function"&&(this.type=a.name||"custom",this.mode=a),this.type=a,this.mode=s.modes[a]):this.mode=this.mode||s.modes[this.type]}},s.generatorAppend=function(a,b,c){var d=this,e=a.length,f=d.automation.length,g=[],h,i,j,k,l;c=c||a,b=b||d.channelCount;for(k=0;k<f;k++)g.push(d[d.automation[k].parameter]);for(i=0,h=0;i<e;i+=b,h++){for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];for(k=0;k<f;k++)l=d.automation[k],l.mode(d,l.parameter,l.amount*l.automation.generatedBuffer[h]);d.generate();for(j=0;j<b;j++)c[i+j]=d.getMix(j)*d.mix+a[i+j]}for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];return c},s.effectAppend=function(a,b,c){var d=this,e=a.length,f=d.automation.length,g=[],h,i,j,k,l;c=c||a,b=b||d.channelCount;for(k=0;k<f;k++)g.push(d[d.automation[k].parameter]);for(i=0,h=0;i<e;i+=b,h++){for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];for(k=0;k<f;k++)l=d.automation[k],l.mode(d,l.parameter,l.amount*l.automation.generatedBuffer[h]);for(j=0;j<b;j++)d.pushSample(a[i+j],j),c[i+j]=d.getMix(j)*d.mix+a[i+j]*(1-d.mix)}for(k=0;k<f;k++)d[d.automation[k].parameter]=g[k];return c},s.bufferEffectAppend=function(a,b,c){var d=this,e=b||d.channelCount,f=a.length,g=d.automation.length,h=[],i,j,k,l,m,n;c=c||a;for(k=0;k<g;k++){h.push([]);for(j=0;j<e;j++)h[k].push(d.effects[j][d.automation[k].parameter])}for(n=0,i=0;i<f;i+=e,n++)for(j=0;j<e;j++){for(k=0;k<g;k++)m=d.automation[k],d.effects[j][m.parameter]=h[k][j],m.mode(d.effects[j],m.parameter,m.amount*m.automation.generatedBuffer[n]);c[i+j]=d.effects[j].pushSample(a[i+j])*d.mix+a[i+j]*(1-d.mix)}for(k=0;k<g;k++)for(j=0;j<e;j++)d.effects[j][d.automation[k].parameter]=h[k][j];return c},s.modes={modulation:function(a,b,c){a.setParam(b,a[b]*c)},addition:function(a,b,c){a.setParam(b,a[b]+c)},subtraction:function(a,b,c){a.setParam(b,a[b]-c)},additiveModulation:function(a,b,c){a.setParam(b,a[b]+a[b]*c)},subtractiveModulation:function(a,b,c){a.setParam(b,a[b]-a[b]*c)},assignment:function(a,b,c){a.setParam(b,c)},absoluteAssignment:function(a,b,d){a.setParam(b,c.abs(d))}},s.__constructror=r,f(function(){h.BufferEffect.prototype.addAutomation=h.EffectClass.prototype.addAutomation=h.GeneratorClass.prototype.addAutomation=function(){return h.Automation.apply(h,[this].concat([].slice.call(arguments)))}}),f(function(){function a(a,b,c,d){var f,g,i,j,k;b?!d&&!(b instanceof e)&&typeof b=="object"&&(d=b,b=[]):b=[],d=d||{},c=c||4096,typeof c=="number"?f=new Float64Array(c):(f=c,c=f.length),j=this.apply(h,b);for(k in d)d.hasOwnProperty(k)&&j.setParam(k,d[k]);return i=h.FFT(j.sampleRate||44100,c/2,!1),g=new Float64Array(c/2),a&&a(g),j.append(g,1),i._process(f,g,"real"),f}u.getFrequencyResponse=function(b,c,d){return a.call(this,function(a){a[0]=a.length/2},b,c,d)},q.getFrequencyResponse=function(b,c,d){return a.call(this,null,b,c,d)}}),u.prototype={type:"effect",sink:!0,source:!0,mix:.5,channelCount:1,append:function(a,b,c){var d=a.length,e,f;c=c||a,b=b||this.channelCount;for(e=0;e<d;e+=b)for(f=0;f<b;f++)this.pushSample(a[e+f],f),c[e+f]=this.getMix(f)*this.mix+a[e+f]*(1-this.mix);return c},addPreProcessing:function(a){a.pushSample=this.pushSample,this.pushSample=function(){return a.apply(this,arguments),a.pushSample.apply(this,arguments)}},removePreProcessing:function(a){var b;while(b=this.pushSample.pushSample)if(b===a||!a)this.pushSample=b,a.pushSample=null},setParam:function(a,b){this[a]=b},pushSample:function(){},getMix:function(){},reset:function(){}},v.prototype={sampleRate:44100,threshold:.95,attack:.01,release:.01,__amplitude:null,sample:0,pushSample:function(a){var b=this._amplitude.pushSample(a)-this.threshold;return this.sample=b>0?a/(1+b):a,this.sample},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case"attack":case"release":this._amplitude[a]=b,this[a]=b;break;default:this[a]=b}}},y.prototype={sample:0,index:0,store:0,feedback:.84,damping:.2,pushSample:function(a){var b=this;return b.sample=b.buffer[b.index],b.store=b.sample*b.invDamping+b.store*b.damping,b.buffer[b.index++]=a+b.store*b.feedback,b.index>=b.bufferSize&&(b.index=0),b.sample},getMix:function(){return this.sample},reset:function(){this.index=this.store=0,this.samples=0,this.buffer=new i(this.bufferSize)},setParam:function(a,b){switch(a){case"damping":this.damping=b,this.invDamping=1-b;break;default:this[a]=b}}},A.BiquadFilterClass=function R(){var a;for(a in R.prototype)R.prototype.hasOwnProperty&&(this[a]=this[a])},A.BiquadFilterClass.prototype={sampleRate:44100,sample:0,inputs:null,outputs:null,coefs:null,pushSample:function(a){var b=this.coefs,c=this.inputs,d=this.outputs;return this.sample=b.b0*a+b.b1*c[0]+b.b2*c[1]-b.a1*d[0]-b.a2*d[1],c.pop(),c.unshift(a),d.pop(),d.unshift(this.sample),this.sample},getMix:function(){return this.sample},reset:function(a,b,c,d,e,f){this.inputs=[0,0],this.outputs=[0,0],this.sampleRate=isNaN(a)?this.sampleRate:a,arguments.length>1&&(this.coefs={b0:b,b1:c,b2:d,a1:e,a2:f})}},A.LowPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=(1-f)/2,j=1-f,k=i,l=1+h,m=-2*f,n=1-h;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.HighPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=(1+f)/2,j=-(1+f),k=i,l=1+h,m=-2*f,n=1-h;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.AllPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=g/(2*d),i=1-h,j=-2*f,k=1+h,l=k,m=j,n=i;this.reset(a,i/l,j/l,k/l,m/l,n/l)},A.BandPass=function(a,b,d){var e=2*c.PI*b/a,f=c.cos(e),g=c.sin(e),h=c.log(2)/2*d*e/g,i=g*(c.exp(h)-c.exp(-h))/2,j=i,k=0,l=-i,m=1+i,n=-2*f,o=1-i;this.reset(a,j/m,k/m,l/m,n/m,o/m)},function(a,b){for(b=0;b<a.length;b++)a[b].prototype=new A.BiquadFilterClass}([A,A.LowPass,A.HighPass,A.AllPass,A.BandPass]),B.prototype={sampleRate:44100,gain:1,sample:0,pushSample:function(a){return this.sample=a*this.gain,this.sample},getMix:function(){return this.sample}},D.prototype={sampleRate:44100,sample:0,pos:0,kernels:null,buffer:null,pushSample:function(a){var b,c,d;this.sample=0,this.buffer[this.pos]=a;for(c=0,d=this.buffer.length,b=this.pos+d;c<d;c++)this.sample+=this.kernels[c]*this.buffer[(b-c)%d];this.pos=(this.pos+1)%this.buffer.length},getMix:function(){return this.sample},setParam:function(a,b){switch(a){case"kernels":this.buffer=new i(b.length),this.pos=0}this[a]=b}},E.prototype={channelCount:2,sample:[0,0],wet:.5,dry:.55,damping:.2223,roomSize:.5,tuning:{},pushSample:function(a,b){var c=a*this.tuning.fixedGain,d=0,e;for(e=0;e<this.numCFs;e++)d+=this.CFs[b][e].pushSample(c);for(e=0;e<this.numAPFs;e++)d=this.APFs[b][e].pushSample(d);this.sample[b]=d*this.wet+a*this.dry},getMix:function(a){return this.sample[a]},reset:function(){var a,b;for(b=0;b<this.channelCount;b++){for(a=0;a<this.numCFs;a++)this.CFs[b][a].reset();for(a=0;a<this.numAPFs;a++)this.APFs[b][a].reset();this.sample[b]=0}},setParam:function(a,b){var c,d,e,f;switch(a){case"roomSize":this.roomSize=b,c=this.roomSize*this.tuning.scaleRoom+this.tuning.offsetRoom;for(f=0;f<this.channelCount;f++)for(e=0;e<this.numCFs;e++)this.CFs[f][e].setParam("feedback",c);break;case"damping":this.damping=b,d=this.damping*this.tuning.scaleDamping;for(f=0;f<this.channelCount;f++)for(e=0;e<this.numCFs;e++)this.CFs[f][e].setParam("damping",d);break;default:this[a]=b}}},E.Tuning=function(a){var b;if(a)for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},E.Tuning.prototype={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},E.AllPassFilter=function(a,b,c){var d=this;d.sampleRate=a,d.buffer=new i(isNaN(b)?500:b),d.bufferSize=d.buffer.length,d.feedback=isNaN(c)?d.feedback:c},E.AllPassFilter.prototype={sample:0,index:0,feedback:.5,pushSample:function(a){var b=this;return bufOut=b.buffer[b.index],b.sample=-a+bufOut,b.buffer[b.index++]=a+bufOut*b.feedback,b.index>=b.bufferSize&&(b.index=0),b.sample},getMix:function(){return this.sample},reset:function(){this.index=0,this.sample=0,this.buffer=new i(this.bufferSize)}},F.prototype={sampleRate:1,time:1e3,feedback:0,bufferPos:0,buffer:null,sample:0,_rstf:1,pushSample:function(a){var b=this,c=b.buffer;return c[b.bufferPos++]+=a,b.bufferPos>b.time*b._rstf&&(b.bufferPos=0),b.sample=c[b.bufferPos],c[b.bufferPos]*=b.feedback,b.sample},getMix:function(){return this.sample},resample:function(a){var b=this,d=b.time/a;return b.buffer=h.Sink.resample(b.buffer,a),b.time=a,b.bufferPos=c.round(d*b.bufferPos),b.buffer},reset:function(a,b){var d=this,e=d.buffer,f,g;a=isNaN(a)?d.sampleRate:a,g=d.sampleRate/a,d.buffer=new i(a*F.MAX_DELAY),d.bufferPos=c.round(g*d.bufferPos),d._rstf=.001*a;if(b){e=h.Sink.resample(e,g);for(f=0;f<e.length&&f<d.buffer.length;f++)d.buffer[f]=e[f]}return d.buffer}},F.MAX_DELAY=2,I.prototype={sampleRate:44100,attack:.01,release:.01,sample:0,pushSample:function(a){return this.sample=c.abs((a>this.sample?this.attack:this.release)*(this.sample-a)+a),this.sample},getMix:function(){return this.sample}};var J=function(){function a(a,b,c,d,e,f){var g=e.twiddle;for(var h=0;h<f;h++){var i=a[2*(b+c*h)],j=a[2*(b+c*h)+1],k=a[2*(b+c*(h+f))],l=a[2*(b+c*(h+f))+1],m=g[2*(0+d*h)],n=g[2*(0+d*h)+1],o=k*m-l*n,p=k*n+l*m,q=i+o,r=j+p,s=i-o,t=j-p;a[2*(b+c*h)]=q,a[2*(b+c*h)+1]=r,a[2*(b+c*(h+f))]=s,a[2*(b+c*(h+f))+1]=t}}function b(a,b,c,d,e,f){var g=e.twiddle,h=f,i=2*f,j=d,k=2*d,l=g[2*(0+d*f)+1];for(var m=0;m<f;m++){var n=a[2*(b+c*m)],o=a[2*(b+c*m)+1],p=a[2*(b+c*(m+h))],q=a[2*(b+c*(m+h))+1],r=g[2*(0+j*m)],s=g[2*(0+j*m)+1],t=p*r-q*s,u=p*s+q*r,v=a[2*(b+c*(m+i))],w=a[2*(b+c*(m+i))+1],x=g[2*(0+k*m)],y=g[2*(0+k*m)+1],z=v*x-w*y,A=v*y+w*x,B=t+z,C=u+A,D=n+B,E=o+C;a[2*(b+c*m)]=D,a[2*(b+c*m)+1]=E;var F=n-B*.5,G=o-C*.5,H=(t-z)*l,I=(u-A)*l,J=F-I,K=G+H;a[2*(b+c*(m+h))]=J,a[2*(b+c*(m+h))+1]=K;var L=F+I,M=G-H;a[2*(b+c*(m+i))]=L,a[2*(b+c*(m+i))+1]=M}}function d(a,b,c,d,e,f){var g,h,i,j,k=e.twiddle,l=f,m=2*f,n=3*f,o=d,p=2*d,q=3*d;for(var r=0;r<f;r++){var s=a[2*(b+c*r)],t=a[2*(b+c*r)+1],u=a[2*(b+c*(r+l))],v=a[2*(b+c*(r+l))+1],w=k[2*(0+o*r)],x=k[2*(0+o*r)+1],y=u*w-v*x,z=u*x+v*w,A=a[2*(b+c*(r+m))],B=a[2*(b+c*(r+m))+1],C=k[2*(0+p*r)],D=k[2*(0+p*r)+1],E=A*C-B*D,F=A*D+B*C,G=a[2*(b+c*(r+n))],H=a[2*(b+c*(r+n))+1],I=k[2*(0+q*r)],J=k[2*(0+q*r)+1],K=G*I-H*J,L=G*J+H*I,M=s+E,N=t+F,O=s-E,P=t-F,Q=y+K,R=z+L,S=y-K,T=z-L,U=M+Q,V=N+R;e.inverse?(g=O-T,h=P+S):(g=O+T,h=P-S);var W=M-Q,X=N-R;e.inverse?(i=O+T,j=P-S):(i=O-T,j=P+S),a[2*(b+c*r)]=U,a[2*(b+c*r)+1]=V,a[2*(b+c*(r+l))]=g,a[2*(b+c*(r+l))+1]=h,a[2*(b+c*(r+m))]=W,a[2*(b+c*(r+m))+1]=X,a[2*(b+c*(r+n))]=i,a[2*(b+c*(r+n))+1]=j}}function e(a,b,c,d,e,f,g){var h,i,j,k,l=e.twiddle,m=e.n,n=new Float64Array(2*g);for(var o=0;o<f;o++){for(h=0,k=o;h<g;h++,k+=f)i=a[2*(b+c*k)],j=a[2*(b+c*k)+1],n[2*h]=i,n[2*h+1]=j;for(h=0,k=o;h<g;h++,k+=f){var p=0;i=n[0],j=n[1],a[2*(b+c*k)]=i,a[2*(b+c*k)+1]=j;for(var q=1;q<g;q++){p=(p+d*k)%m;var r=a[2*(b+c*k)],s=a[2*(b+c*k)+1],t=n[2*q],u=n[2*q+1],v=l[2*p],w=l[2*p+1],x=t*v-u*w,y=t*w+u*v,z=r+x,A=s+y;a[2*(b+c*k)]=z,a[2*(b+c*k)+1]=A}}}}function f(c,g,h,i,j,k,l,m,n){var o,p,q,r=m.shift(),s=m.shift();if(s==1)for(o=0;o<r*s;o++)p=i[2*(j+k*l*o)],q=i[2*(j+k*l*o)+1],c[2*(g+h*o)]=p,c[2*(g+h*o)+1]=q;else for(o=0;o<r;o++)f(c,g+h*o*s,h,i,j+o*k*l,k*r,l,m.slice(),n);switch(r){case 2:a(c,g,h,k,n,s);break;case 3:b(c,g,h,k,n,s);break;case 4:d(c,g,h,k,n,s);break;default:e(c,g,h,k,n,s,r)}}function h(a,b,c){var d=[].slice.call(arguments);d[0]=this.sampleRate=isNaN(a)||a===null?this.sampleRate:a,d[1]=this.bufferSize=isNaN(b)||b===null?this.bufferSize:b,d[2]=!!c,this.__super.apply(this,d.slice(1))}"use strict";var g=function(a,b){if(arguments.length<2)throw new RangeError("You didn't pass enough arguments, passed `"+arguments.length+"'");a=~~a,b=!!b;if(a<1)throw new RangeError("n is outside range, should be positive integer, was `"+a+"'");this.inputBuffer=new Float64Array(2*a),this.outputBuffer=new Float64Array(2*a);var d={n:a,inverse:b,factors:[],twiddle:new Float64Array(2*a),scratch:new Float64Array(2*a)},e=d.twiddle,f=2*c.PI/a,g,h;for(g=0;g<a;g++)b?h=f*g:h=-f*g,e[2*g]=c.cos(h),e[2*g+1]=c.sin(h);var i=4,j=c.floor(c.sqrt(a));while(a>1){while(a%i){switch(i){case 4:i=2;break;case 2:i=3;break;default:i+=2}i>j&&(i=a)}a/=i,d.factors.push(i),d.factors.push(a)}this.state=d,this.resetFT()};return g.prototype.process=function(a,b,c){this.process_explicit(a||this.outputBuffer,0,1,b||this.inputBuffer,0,1,c)},g.prototype.process_explicit=function(a,b,c,d,e,g,h){var i,j,k;c=~~c,g=~~g,h=h||this.inputType;var l=h==="real"?h:"complex";if(c<1)throw new RangeError("outputStride is outside range, should be positive integer, was `"+c+"'");if(g<1)throw new RangeError("inputStride is outside range, should be positive integer, was `"+g+"'");if(l=="real"){for(i=0;i<this.state.n;i++)j=d[e+g*i],k=0,this.state.scratch[2*i]=j,this.state.scratch[2*i+1]=k;f(a,b,c,this.state.scratch,0,1,1,this.state.factors.slice(),this.state)}else if(d==a){f(this.state.scratch,0,1,d,e,1,g,this.state.factors.slice(),this.state);for(i=0;i<this.state.n;i++)j=this.state.scratch[2*i],k=this.state.scratch[2*i+1],a[2*(b+c*i)]=j,a[2*(b+c*i)+1]=k}else f(a,b,c,d,e,1,g,this.state.factors.slice(),this.state)},g.prototype.__super=g,h.prototype=g.prototype,h.prototype.inputType="real",h.prototype.sampleRate=44100,h.prototype.bufferSize=4096,h.prototype.resetFT=function(a){this.inputBuffer=new Float64Array(2*this.bufferSize),this.outputBuffer=new Float64Array(2*this.bufferSize),this.spectrum=new Float64Array(this.bufferSize/2),this.bandWidth=this.sampleRate/this.bufferSize/2,this.peakBand=0,this.peak=0,this.sample=0,this.offset=0,this.maxOffset=this.inputType==="real"?this.bufferSize:this.bufferSize*2,this.pushSample=this._pushSample},h.prototype.pushSample=function(a){return this.resetFT(),this.pushSample(a)},h.prototype._pushSample=function(a){return this.inputBuffer[this.offset]=a,this.sample=a,this.offset=(this.offset+1)%this.maxOffset,this.offset||this.process(),a},h.prototype.getMix=function(){return this.sample},h.prototype.getBandFrequency=function(a){return this.bandWidth*a+this.bandWidth*.5},h.prototype.calculateSpectrum=function(){var a,b,d,e,f,g=this.spectrum,h=this.outputBuffer,i=2/this.bufferSize,j=this.bufferSize/2;for(a=0,b=2;a<j;a++,b+=2)d=h[b+0],e=h[b+1],f=i*c.sqrt(d*d,e*e),f>this.peak&&(this.peakBand=a,this.peak=f),this.spectrum[a]=f},h.prototype._process=h.prototype.process,h.prototype.process=function(){this._process.apply(this,arguments),this.calculateSpectrum()},h}();K.prototype={sampleRate:44100,attack:50,decay:50,sustain:1,release:50,sustainTime:null,releaseTime:null,gate:!1,state:3,value:0,_st:0,generate:function(){return this.states[this.state].call(this),this.value},getMix:function(){return this.value},triggerGate:function(a){a=typeof a=="undefined"?!this.gate:a,this.gate=a,this.state=a?0:this.releaseTime===null?3:5,this._st=0},states:[function(){this.value+=1e3/this.sampleRate/this.attack,this.value>=1&&(this.state=1)},function(){this.value-=1e3/this.sampleRate/this.decay*this.sustain,this.value<=this.sustain&&(this.sustainTime===null?this.state=2:(this._st=0,this.state=4))},function(){this.value=this.sustain},function(){this.value=c.max(0,this.value-1e3/this.sampleRate/this.release)},function(){this.value=this.sustain,this._st++>=this.sampleRate*.001*this.sustainTime&&(this._st=0,this.state=this.releaseTime===null?3:5)},function(){this.value=c.max(0,this.value-1e3/this.sampleRate/this.release),this._st++>=this.sampleRate*.001*this.releaseTime&&(this._st=0,this.state=0)}]},L.prototype={sampleRate:44100,value:1,schedule:null,clock:0,getMix:function(){return this.value},generate:function(){var a;for(a=0;a<this.schedule.length;a++)this.schedule[a].t--&&(this.value=this.schedule[a].v,this.schedule.splice(a--,1))},setValue:function(a){this.schedule.push({v:a,t:~~((+(new Date)-this.clock)/1e3*this.sampleRate)})},reset:function(a){this.value=isNaN(a)?this.value:a,this.clock=+(new Date)}},M.prototype={sampleRate:44100,stepLength:200,steps:null,attack:0,phase:0,value:0,generate:function(){var a=this,b=a.sampleRate/1e3*a.stepLength,c=a.steps,d=b*c.length,e,f,g,h,i;return a.phase=(a.phase+1)%d,e=a.phase/d*c.length,f=e%1,e=~~e,g=(e||c.length)-1,h=c[e]-c[g],i=c[e],f<a.attack&&(i-=h-h/a.attack*f),a.value=i,i},getMix:function(){return this.value},triggerGate:function(){this.phase=0}},function(a,b){function f(a,b){return b?c(a&255)+f(a>>8,b-1):""}function g(a,b){return b?g(a>>8,b-1)+c(255-a&255):""}function h(a,b,c){return c?g(a,b):f(a,b)}function i(a,c){var d=a.length,e=d-1,f=0,g=b.pow,h;if(c)for(h=0;h<d;h++)f+=(255-a.charCodeAt(h))*g(256,e-h);else for(h=0;h<d;h++)f+=a.charCodeAt(h)*g(256,h);return f}function j(a,c,d,e){var f=b.pow,g=b.floor,h=j.convertFromBinary,i=j.convertToBinary,k=a/8,l=f(2,a),m=l/2,n=m-1,o=1/m,p=1/n;return e?d?c?function(a,b){return a=g(a<0?a*m+l:a*n),i(a,k,b)}:function(a,b){return i(g(a*n),k,b)}:c?function(a,b){return i(a<0?a+l:a,k,b)}:function(a,b){return i(a,k,b)}:d?c?function(a,b){var c=h(a,b);return c>n?(c-l)*o:c*p}:function(a,b){return h(a,b)*p}:c?function(a,b){var c=h(a,b);return c>n?c-l:c}:function(a,b){return h(a,b)}}var c=String.fromCharCode,d=!0,e=!1;j.convertToBinary=h,j.convertFromBinary=i,j.fromQ32=j(32,d,d,d),j.toQ32=j(32,d,d,e),j.fromQ24=j(24,d,d,d),j.toQ24=j(24,d,d,e),j.fromQ16=j(16,d,d,d),j.toQ16=j(16,d,d,e),j.fromQ8=j(8,d,d,d),j.toQ8=j(8,d,d,e),j.fromInt32=j(32,d,e,d),j.toInt32=j(32,d,e,e),j.fromInt16=j(16,d,e,d),j.toInt16=j(16,d,e,e),j.fromInt8=j(8,d,e,d),j.toInt8=j(8,d,e,e),j.fromUint32=j(32,e,e,d),j.toUint32=j(32,e,e,e),j.fromUint16=j(16,e,e,d),j.toUint16=j(16,e,e,e),j.fromUint8=j(8,e,e,d),j.toUint8=j(8,e,e,e),a.Binary=j}(this,c),function(a,b){function c(a){this.data=a}function g(a,b,c){var e=b/8;d["read"+a+b]=function(a){return c(this.read(e),a)}}var d=c.prototype={read:function(a){var b=this,c=b.data.substr(0,a);return b.skip(a),c},skip:function(a){var b=this,c=b.data=b.data.substr(a);return b.pointer+=a,c.length},readBuffer:function(a,b,c){var d=this,e="read"+c+b,f=b/8,g=a.length,h=0;while(d.data&&h<g)a[h++]=d[e]();return h}},e,f;for(e in b)f=/to([a-z]+)([0-9]+)/i.exec(e),f&&g(f[1],f[2],b[e]);a.Stream=c,c.newType=g}(this,this.Binary),this.PCMData=function(a,b){function f(a){return(typeof a=="string"?f.decode:f.encode)(a)}var d=typeof Uint8Array=="undefined"?e:Uint8Array;return f.decodeFrame=function(a,c,e){if(c===8){var f=new d(e.length);(new b(a)).readBuffer(f,8,"Uint");for(c=0;c<e.length;c++)e[c]=(f[c]-127.5)*127.5}else(new b(a)).readBuffer(e,c,"Q");return e},f.encodeFrame=function(b,c){var d=a[(c===8?"fromUint":"fromQ")+c],e=b.length,f="",g;if(c===8)for(g=0;g<e;g++)f+=d(b[g]*127.5+127.5);else for(g=0;g<e;g++)f+=d(b[g]);return f},f.decode=function(a,c){function C(){t=d.read(4),u=d.readUint32(),w=d.read(u),y=A[t]=A[t]||[],t==="data"?(v=~~(u/r),x=B.data=new i(v),f.decodeFrame(w,r*8,x)):y.push(w);if(!c)return;d.data?setTimeout(C,1):c(B)}var d=new b(a),e=d.read(4),g=d.readUint32();d=new b(d.read(g));var h=d.read(4),j=d.read(4),k=d.readUint32(),l=new b(d.read(k)),m=l.readUint16(),n=l.readUint16(),o=l.readUint32(),p=l.readUint32(),q=l.readUint16(),r=q/n,s=l.readUint16(),t,u,v,w,x,y,z,A={},B={channelCount:n,bytesPerSample:q/n,sampleRate:p/q,chunks:A,data:x};if(c)d.data?C():c(B);else while(d.data)C();return B},f.encode=function(b,d){var e=a.fromUint32,g=a.fromUint16,h=b.data,i=b.sampleRate,j=b.channelCount||1,k=b.bytesPerSample||1,l=k*8,m=j*k,n=i*m,o=h.length,p=o*k,q=c.pow(2,l-1)-1,r=[],s="",t,u,v,w;r.push("fmt "+e(16)+g(1)+g(j)+e(i)+e(n)+g(m)+g(l)),r.push("data"+e(p)+f.encodeFrame(h,l)),w=b.chunks;if(w)for(u in w)if(w.hasOwnProperty(u)){t=w[u];for(v=0;v<t.length;v++)s=t[v],r.push(u+e(s.length)+s)}return r=r.join(""),r="RIFF"+e(r.length)+"WAVE"+r,d&&setTimeout(function(){d(r)},1),r},f}(this.Binary,this.Stream);var N=this.Sink=function(a){function b(a,c,d,e){var f=b.sinks.list,g;for(g=0;g<f.length;g++)if(f[g].enabled)try{return new f[g](a,c,d,e)}catch(h){}throw b.Error(2)}function c(){}function d(a,c,e,f,g){e=e||c.prototype,c.prototype=new b.SinkClass,c.prototype.type=a,c.enabled=!f;var h;for(h in e)e.hasOwnProperty(h)&&(c.prototype[h]=e[h]);d[a]=c,d.list[g?"unshift":"push"](c)}return b.SinkClass=c,c.prototype=b.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(a,c,d,e){this.channelCount=isNaN(c)||c===null?this.channelCount:c,this.bufferSize=isNaN(d)||d===null?this.bufferSize:d,this.sampleRate=isNaN(e)||e===null?this.sampleRate:e,this.readFn=a,this.activeRecordings=[],this.previousHit=+(new Date),b.EventEmitter.call(this),b.emit("init",[this].concat([].slice.call(arguments)))},process:function(a,c){this.emit("preprocess",arguments),this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);if(this.channelMode==="interleaved")this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var d=b.deinterleave(a,this.channelCount),e=[d].concat([].slice.call(arguments,1));this.emit("audioprocess",e),this.readFn&&this.readFn.apply(this,e),b.interleave(d,this.channelCount,a)}this.emit("postprocess",arguments),this.previousHit=+(new Date),this.writePosition+=a.length/c},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){if(this.isReady)return;this.isReady=!0,this.emit("ready",[])}},b.sinks=b.devices=d,b.sinks.list=[],b.singleton=function(){var a=b.apply(null,arguments);return b.singleton=function(){return a},a},a.Sink=b,b}(function(){return this}());void function(a){function b(){var a;for(a in b.prototype)b.prototype.hasOwnProperty(a)&&(this[a]=b.prototype[a]);this._listeners={}}b.prototype={_listeners:null,emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b);return this},on:function(a,b){return this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this},off:function(a,b){if(this._listeners[a]){if(!b)return delete this._listeners[a],this;for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c]===b&&this._listeners[a].splice(c--,1);this._listeners[a].length||delete this._listeners[a]}return this}},a.EventEmitter=b,b.call(a)}(this.Sink),void function(a){function b(a){if(!b.hasOwnProperty(a))throw b(1);if(!(this instanceof b))return new b(a);var c;for(c in b[a])b[a].hasOwnProperty(c)&&(this[c]=b[a][c]);this.code=a}b.prototype=new Error,b.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},b[1]={message:"No such error code.",explanation:"The error code does not exist."},b[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},b[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},b[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},b[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},a.Error=b}(this.Sink),void function(a){var b,c,d,e;void function(a,f){function g(a,b){var c,d=b.slice();for(c=d.shift();typeof c!="undefined";c=d.shift()){c=Function("return typeof "+c+a+'=== "undefined" ? undefined : '+c+a)();if(c)return c}}b=g("Blob",a),c=g("BlobBuilder",a),d=g("URL",f),e=g("btoa",[""])}(["","Moz","WebKit","MS"],["","webkit"]);var f=b&&d&&function(a,c){return d.createObjectURL(new b([a],{type:c}))},g=c&&d&&function(a,b){var e=new c;return e.append(a),d.createObjectURL(e.getBlob(b))},h=e&&function(a,b){return"data:"+b+";base64,"+e(a)},i=f||g||h;if(!i)return;f&&(i.createBlob=f),g&&(i.createBlobBuilder=g),h&&(i.createData=h),b&&(i.Blob=b),c&&(i.BlobBuilder=c),d&&(i.URL=d),a.createDynURL=i,a.revokeDynURL=function(a){return typeof a=="string"&&a.indexOf("data:")===0?!1:d.revokeObjectURL(a)}}(this.Sink),void function(a){function c(){return b(this,"terminate",this._terminate),a.revokeDynURL(this._url),delete this._url,delete this._terminate,this.terminate()}function e(d){function f(a,d,f){try{var g=a(d,"text/javascript"),h=new Worker(g);return b(h,"_url",g),b(h,"_terminate",h.terminate),b(h,"terminate",c),e.type?h:(e.type=f,e.createURL=a,h)}catch(i){return null}}var g=a.createDynURL,h;return e.createURL?f(e.createURL,d,e.type):(h=f(g.createBlob,d,"blob"),h?h:(h=f(g.createBlobBuilder,d,"blobbuilder"),h?h:(h=f(g.createData,d,"data"),h)))}var b=d.defineProperty?function(a,b,c){d.defineProperty(a,b,{value:c,configurable:!0,writable:!0})}:function(a,b,c){a[b]=c};a.EventEmitter.call(e),e.test=function(){function c(b){if(e.ready)return;e.ready=!0,e.working=b,e.emit("ready",[b]),e.off("ready"),b&&a&&a.terminate(),a=null}e.ready=e.working=!1,e.type="",e.createURL=null;var a=e("this.onmessage=function(e){postMessage(e.data)}"),b="inlineWorker";a?(a.onmessage=function(a){c(a.data===b)},a.postMessage(b),setTimeout(function(){c(!1)},1e3)):setTimeout(function(){c(!1)},0)},a.inlineWorker=e,e.test()}(this.Sink),void function(a){a.doInterval=function(b,c){function f(f){a.inlineWorker.working&&!f?(d=a.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+c+");"),d.onmessage=function(){b()},e=function(){d.terminate()}):(d=setInterval(b,c),e=function(){clearInterval(d)})}var d,e;return a.inlineWorker.ready?f():a.inlineWorker.on("ready",function(){f()}),function(){e?e():a.inlineWorker.ready||a.inlineWorker.on("ready",function(){e&&e()})}}}(this.Sink),void function(a){a.sinks("audiodata",function(){function m(){if(d){f=e.mozWriteAudio(d),c+=f;if(f<d.length)return d=d.subarray(f),d;d=null}g=e.mozCurrentSampleOffset(),h=Number(g+(k!==g?b.bufferSize:b.preBufferSize)*b.channelCount-c),g===k&&b.emit("error",[a.Error(16)]);if(h>0||k===g){b.ready();try{j=new i(k===g?b.preBufferSize*b.channelCount:b.forceBufferSize?h<b.bufferSize*2?b.bufferSize*2:h:h)}catch(l){b.emit("error",[a.Error(18)]),b.kill();return}b.process(j,b.channelCount),f=b._audio.mozWriteAudio(j),f<j.length&&(d=j.subarray(f)),c+=f}k=g}var b=this,c=0,d=null,e=new Audio,f,g,h,j,k,l;b.start.apply(b,arguments),b.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4],e.mozSetup(b.channelCount,b.sampleRate),this._timers=[],this._timers.push(a.doInterval(function(){+(new Date)-b.previousHit>2e3&&(b._audio=e=new Audio,e.mozSetup(b.channelCount,b.sampleRate),c=0,b.emit("error",[a.Error(17)]))},1e3)),this._timers.push(a.doInterval(m,b.interval)),b._bufferFill=m,b._audio=e},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:100,kill:function(){while(this._timers.length)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),a.sinks.moz=a.sinks.audiodata}(this.Sink),function(a,b){function c(a){var b=document.createElement("audio");return a&&(b.src=a),b}function d(){var a=this;a.currentFrame=c(),a.nextFrame=c(),a._onended=function(){a.samples+=a.bufferSize,a.nextClip()}}b=a.sinks,b("wav",function(){function k(){if(d._audio.hasNextFrame)return;d.ready(),a.memcpy(j,0,g,0),d.process(g,d.channelCount),d._audio.setSource("data:audio/wav;base64,"+btoa(h.PCMData.encode({data:g,sampleRate:d.sampleRate,channelCount:d.channelCount,bytesPerSample:d.quality}))),d._audio.currentFrame.src||d._audio.nextClip()}var d=this,e=new b.wav.wavAudio,f=typeof f=="undefined"?h.PCMData:f;d.start.apply(d,arguments);var g=new i(d.bufferSize*d.channelCount),j=new i(d.bufferSize*d.channelCount);if(!c().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;d.kill=a.doInterval(k,40),d._bufferFill=k,d._audio=e},{quality:1,bufferSize:22050,getPlaybackTime:function(){var a=this._audio;return(a.currentFrame?a.currentFrame.currentTime*this.sampleRate:0)+a.samples}}),d.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var a=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=a,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(a){this.nextFrame.src=a,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},b.wav.wavAudio=d}(this.Sink),void function(a){a.sinks("dummy",function(){function c(){var a=new i(b.bufferSize*b.channelCount);b.process(a,b.channelCount)}var b=this;b.start.apply(b,arguments),b._kill=a.doInterval(c,b.bufferSize/b.sampleRate*1e3),b._callback=c},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(a,b){var c=typeof window=="undefined"?null:window.webkitAudioContext||window.AudioContext;a("webaudio",function(c,d,f,g){function n(a){var b=a.outputBuffer,c=b.numberOfChannels,d,f,g=b.length,j=b.size,k=new e(c),n;h.ready(),l=l&&l.length===g*c?l:new i(g*c),m=m&&m.length===l.length?m:new i(g*c),l.set(m);for(d=0;d<c;d++)k[d]=b.getChannelData(d);h.process(l,h.channelCount);for(d=0;d<g;d++)for(f=0;f<c;f++)k[f][d]=l[d*h.channelCount+f]}var h=this,j=a.webaudio.getContext(),k=null,l=null,m=null;h.start.apply(h,arguments),k=j.createJavaScriptNode(h.bufferSize,h.channelCount,h.channelCount),h.sampleRate=j.sampleRate,k.onaudioprocess=n,k.connect(j.destination),h._context=j,h._node=k,h._callback=n,b.push(k)},{kill:function(){this._node.disconnect(0);for(var a=0;a<b.length;a++)b[a]===this._node&&b.splice(a--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),a.webkit=a.webaudio,a.webaudio.fix82795=b,a.webaudio.getContext=function(){var b=new c;return a.webaudio.getContext=function(){return b},b}}(this.Sink.sinks,[]),function(a){a.sinks("worker",function(){function g(b){a.isReady||a.initMSP(b),a.ready();var e=a.channelCount,g=b.audioLength,h,j;c=c&&c.length===g*e?c:new i(g*e),d=d&&d.length===c.length?d:new i(g*e),f=f&&f.length===c.length?f:new i(g*e),c.set(f),d.set(f),a.process(c,a.channelCount);for(h=0;h<e;h++)for(j=0;j<g;j++)d[h*b.audioLength+j]=c[h+j*e];b.writeAudio(d)}function h(b){a.isReady||a.initWA(b),a.ready();var d=b.outputBuffer,g=d.numberOfChannels,h,j,k=d.length,l=d.size,m=new e(g),n;c=c&&c.length===k*g?c:new i(k*g),f=f&&f.length===c.length?f:new i(k*g),c.set(f);for(h=0;h<g;h++)m[h]=d.getChannelData(h);a.process(c,a.channelCount);for(h=0;h<k;h++)for(j=0;j<g;j++)m[j][h]=c[h*a.channelCount+j]}var a=this,b=function(){return this}(),c=null,d=null,f=null;a.start.apply(a,arguments),importScripts(),b.onprocessmedia=g,b.onaudioprocess=h,a._mspBufferFill=g,a._waBufferFill=h},{ready:!1,initMSP:function(a){this.channelCount=a.audioChannels,this.sampleRate=a.audioSampleRate,this.bufferSize=a.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(a){var b=a.outputBuffer;this.channelCount=b.numberOfChannels,this.sampleRate=b.sampleRate,this.bufferSize=b.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(a){(function(){function b(c,d){return c&&d?b[c]=d:c&&b[c]instanceof Function&&(a.interpolate=b[c]),b[c]}a.interpolation=b,b("linear",function(a,b){var d=c.floor(b),e=d+1,f=b-d;return e=e<a.length?e:0,a[d]*(1-f)+a[e]*f}),b("nearest",function(a,b){return b>=a.length-.5?a[0]:a[c.round(b)]}),b("linear")})(),a.resample=function(b,d,e,f,g){var h=arguments.length,j=h===2?d:h===3?d/e:f/d*g/e,k=b.length,l=c.ceil(k/j),m=new i(l),n,o;for(n=0,o=0;n<k;n+=j)m[o++]=a.interpolate(b,n);return m}}(this.Sink),function(a){a.deinterleave=function(a,b){var c=a.length,d=c/b,e=[],f,g;for(f=0;f<b;f++){e[f]=new i(d);for(g=0;g<d;g++)e[f][g]=a[g*b+f]}return e},a.interleave=function(a,b,c){b=b||a.length;var d=a[0].length,e=a.length,f,g;c=c||new i(d*b);for(f=0;f<e;f++)for(g=0;g<d;g++)c[f+g*b]=a[f][g];return c},a.mix=function(a){var b=[].slice.call(arguments,1),d,e,f;for(f=0;f<b.length;f++){d=c.max(a.length,b[f].length);for(e=0;e<d;e++)a[e]+=b[f][e]}return a},a.resetBuffer=function(a){var b=a.length,c;for(c=0;c<b;c++)a[c]=0;return a},a.clone=function(a,b){var c=a.length,d;b=b||new i(c);for(d=0;d<c;d++)b[d]=a[d];return b},a.createDeinterleaved=function(a,b){var c=new e(b),d;for(d=0;d<b;d++)c[d]=new i(a);return c},a.memcpy=function(a,b,c,d,e){a=a.subarray||a.slice?a:a.buffer,c=c.subarray||c.slice?c:c.buffer,a=b?a.subarray?a.subarray(b,e&&b+e):a.slice(b,e&&b+e):a;if(c.set)c.set(a,d);else for(var f=0;f<a.length;f++)c[f+d]=a[f];return c},a.memslice=function(a,b,c){return a.subarray?a.subarray(b,c):a.slice(b,c)},a.mempad=function(b,c,d){return c=c.length?c:new b.constructor(c),a.memcpy(b,0,c,d),c},a.linspace=function(a,b,c){var d,f,g,h;c=c.length?(d=c.length)&&c:e(d=c),h=(b-a)/--d;for(g=a+h,f=1;f<d;f++,g+=h)c[f]=g;return c[0]=a,c[d]=b,c},a.ftoi=function(a,b,d){var e,f=c.pow(2,b-1);d=d||new a.constructor(a.length);for(e=0;e<a.length;e++)d[e]=~~(f*a[e]);return d}}(this.Sink),function(a){function b(b,c){a.EventEmitter.call(this),this.bufferSize=isNaN(b)||b===null?this.bufferSize:b,this.channelCount=isNaN(c)||c===null?this.channelCount:c;var d=this;this.callback=function(){return d.process.apply(d,arguments)},this.resetBuffer()}b.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new i(this.bufferSize),this.zeroBuffer=new i(this.bufferSize)},process:function(a,b){this.offset===null&&this.loadBuffer();for(var c=0;c<a.length;c++)this.offset>=this.buffer.length&&this.loadBuffer(),a[c]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,a.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},a.Proxy=b,a.prototype.createProxy=function(b){var c=new a.Proxy(b,this.channelCount);return c.parentSink=this,this.on("audioprocess",c.callback),c}}(this.Sink),void function(a){function b(){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}a.on("init",function(a){a.on("preprocess",b)}),a.prototype.ringBuffer=null,a.prototype.ringSpin=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=this.ringOffset,f;for(f=0;f<c;f++)a[f]+=b[e],e=(e+1)%d;this.ringOffset=e},a.prototype.ringSpinDeinterleaved=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=b[0].length,f=d*e,g=this.ringOffset,h,i;for(h=0;h<c;h+=d){for(i=0;i<d;i++)a[h+i]+=b[i][g];g=(g+1)%e}this.ringOffset=i}}(this.Sink),void function(a,b){b=a.prototype,a.on("init",function(a){a.asyncBuffers=[],a.syncBuffers=[],a.on("preprocess",a.writeBuffersSync),a.on("postprocess",a.writeBuffersAsync)}),b.writeMode="async",b.asyncBuffers=b.syncBuffers=null,b.writeBuffersAsync=function(a){var b=this.asyncBuffers,d=a.length,e,f,g,h,i;if(b)for(g=0;g<b.length;g++){e=b[g],f=e.b.length,i=e.d,e.d-=c.min(i,d);for(h=0;h+i<d&&h<f;h++)a[h+i]+=e.b[h];e.b=e.b.subarray(h+i),g>=f&&b.splice(g--,1)}},b.writeBuffersSync=function(a){var b=this.syncBuffers,c=a.length,d=0,e=0;for(;d<c&&b.length;d++){a[d]+=b[0][e];if(b[0].length<=e){b.splice(0,1),e=0;continue}e++}b.length&&(b[0]=b[0].subarray(e))},b.writeBufferAsync=function(b,c){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var d=this.asyncBuffers;return d.push({b:b,d:isNaN(c)?~~((+(new Date)-this.previousHit)/1e3*this.sampleRate):c}),d.length},b.writeBufferSync=function(b){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var c=this.syncBuffers;return c.push(b),c.length},b.writeBuffer=function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},b.getSyncWriteOffset=function(){var a=this.syncBuffers,b=0,c;for(c=0;c<a.length;c++)b+=a[c].length;return b}}(this.Sink),void function(a){function b(a){this.boundTo=a,this.buffers=[],a.activeRecordings.push(this)}a.on("init",function(a){a.activeRecordings=[],a.on("postprocess",a.recordData)}),a.prototype.activeRecordings=null,a.prototype.record=function(){var b=new a.Recording(this);return this.emit("record",[b]),b},a.prototype.recordData=function(a){var b=this.activeRecordings,c,d=b.length;for(c=0;c<d;c++)b[c].add(a)},b.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,c=this.buffers,d,e,f,g=c.length;for(f=0;f<g;f++)a+=c[f].length;d=new i(a);for(f=0;f<g;f++){for(e=0;e<c[f].length;e++)d[b+e]=c[f][e];b+=c[f].length}return d}},a.Recording=b}(this.Sink),function(){function b(){var a=arguments,b=a.length,c,d;for(d=0;d<b;d++)c=a[d],this.postMessage({type:"injection",code:c instanceof Function?"("+String(c)+").call(this);":c})}h.AudioWorker=function(c,d){var e="var audioLib=("+String(a)+").call({},this,Math,Object,Array);\n",f;for(f=0;f<h.plugins._pluginList.length;f++)e+="("+String(h.plugins._pluginList[url])+"());\n";return d&&(e+='this.addEventListener("message",function(e){e.data&&e.data.type==="injection"&&Function(e.data.code).call(this)},true);\n'),e+=c instanceof Function?"("+String(c)+").call(this);":c.textContent||c,e=N.inlineWorker(e),d&&(e.inject=b),e}}(),function(a,b,d,e){d=O.prototype={sampleRate:44100,frequency:440,phaseOffset:0,pulseWidth:.5,fm:0,waveShape:"sine",phase:0,_p:0,generate:function(){var a=this,b=+a.frequency,c=a.pulseWidth,d=a.phase;b+=b*a.fm,a.phase=(d+b/a.sampleRate/2)%1,d=(a.phase+a.phaseOffset)%1,a._p=d<c?d/c:(d-c)/(1-c)},getMix:function(){return this[this.waveShape]()},getPhase:function(){return this._p},reset:function(a){this.phase=this._p=isNaN(a)?0:a},setWavetable:function(a){return this.waveTable=a,!0},sine:function(){return c.sin(this._p*a)},triangle:function(){return this._p<.5?4*this._p-1:3-4*this._p},square:function(){return this._p<.5?-1:1},sawtooth:function(){return 1-this._p*2},invSawtooth:function(){return this._p*2-1},pulse:function(){return this._p<.5?this._p<.25?this._p*8-1:1-(this._p-.25)*8:-1},wavetable:function(){return h.Sink.interpolate(this.waveTable,this._p*this.waveTable.length)},waveShapes:[]};for(e=0;e<b.length;e++)d[e]=d[b[e]],d.waveShapes.push(d[e]);O.WaveShape=function(a,b){return b&&(this.prototype[a]=b),this.prototype[a]},O.createMixWave=function(a,b){var c=b.length,d,e;return this.WaveShape(a,function(){d=0;for(e=0;e<c;e++)d+=this[b[e].shape]()*b[e].mix;return d})}}(c.PI*2,["sine","triangle","pulse","sawtooth","invSawtooth","square"]),P.prototype={sampleRate:44100,pitch:440,delayStart:0,delayEnd:0,maxVoices:1/0,sampleSize:0,voices:null,sample:null,samples:null,data:null,noteOn:function(a,b){a=isNaN(a)?this.pitch:a;var c=this,d=a/c.pitch,e=c.sampleRate,f=e*c.delayStart,g=c.sampleSize-e*c.delayEnd-1,h={f:a,p:f,s:d,l:g,v:isNaN(b)?1:b};c.voices.push(h);while(c.voices.length>c.maxVoices)g=c.voices.shift(),g.onend&&g.onend();return h},generate:function(){var a=this.voices,b,c;for(b=0;b<a.length;b++)c=a[b],c.p+=c.s,c.p>c.l&&a.splice(b--,1)&&c.onend&&c.onend()},getMix:function(a){var b=this.voices,c=0,d;a=a||0;if(this.samples[a])for(d=0;d<b.length;d++)c+=h.Sink.interpolate(this.samples[a],b[d].p)*b[d].v;return c},load:function(a,b){var c=this,d=c.samples=h.Sink.deinterleave(a.data,a.channelCount),e;if(b)for(e=0;e<d.length;e++)d[e]=h.Sink.resample(d[e],a.sampleRate,c.sampleRate);c.sample=a.data,c.samples=d,c.data=a,c.sampleSize=d[0].length}},Q.prototype={sampleRate:44100,color:"white",b0:0,b1:0,b2:0,b3:0,b4:0,b5:0,c1:null,c2:null,c3:null,c4:null,q:15,q0:null,q1:null,brownQ:0,value:0,reset:function(a,b){this.sampleRate=isNaN(a)?this.sampleRate:a,this.color=typeof b=="string"?b:this.color,this.c1=(1<<this.q)-1,this.c2=~~(this.c1/3)+1,this.c3=1/this.c1,this.c1=this.c2*6,this.c4=3*(this.c2-1),this.q0=c.exp(-200*c.PI/this.sampleRate),this.q1=1-this.q0},generate:function(){this.value=this[this.color]()},getMix:function(){return this.value},white:function(){var a=c.random();return(a*this.c1-this.c4)*this.c3},pink:function(){var a=this.white();return this.b0=.997*this.b0+.029591*a,this.b1=.985*this.b1+.032534*a,this.b2=.95*this.b2+.048056*a,this.b3=.85*this.b3+.090579*a,this.b4=.62*this.b4+.10899*a,this.b5=.25*this.b5+.255784*a,.55*(this.b0+this.b1+this.b2+this.b3+this.b4+this.b5)},brown:function(){var a=this.white();return this.brownQ=this.q1*a+this.q0*this.brownQ,6.2*this.brownQ}},h.ADSREnvelope=K,h.StepSequencer=M,h.UIControl=L,h.BiquadFilter=A,h.BitCrusher=w,h.Chorus=H,h.CombFilter=y,h.Compressor=x,h.Convolution=D,h.Delay=F,h.Distortion=C,h.GainController=B,h.IIRFilter=G,h.LP12Filter=z,h.Limiter=v,h.Reverb=E,h.Noise=Q,h.Oscillator=O,h.Sampler=P,h.Amplitude=I,h.FFT=J,h.AudioDevice=h.Sink=function(){return this}().Sink,h.Automation=s,h.BufferEffect=p,h.EffectClass=u,h.GeneratorClass=q,h.codecs=h.Codec=t,h.plugins=o;while(f.list.length)f.list.shift().call(h);return f=null,void function(a,b){function c(a,b,d,e){var f,g;if(b){d=d||b.prototype,f=b.prototype=new u,f.name=f.fxid=a,c[a]=n(a,b,e);for(g in d)d.hasOwnProperty(g)&&(f[g]=d[g]);for(g in u)g!=="prototype"&&u.hasOwnProperty(g)&&(c[a][g]=u[g])}return c[a]}h.effects=c;for(b=0;b<a.length;b++)h[a[b]]=c(a[b],h[a[b]],h[a[b]].prototype);c("BiquadAllPassFilter",A.AllPass),c("BiquadBandPassFilter",A.BandPass),c("BiquadHighPassFilter",A.HighPass),c("BiquadLowPassFilter",A.LowPass),c("FreeverbAllPassFilter",E.AllPassFilter)}(["BiquadFilter","BitCrusher","Chorus","CombFilter","Compressor","Convolution","Delay","Distortion","GainController","IIRFilter","LP12Filter","Limiter","Reverb","Amplitude","FFT"]),void function(a,b){function c(a,b,d,e){var f,g;if(b){d=d||b.prototype,f=b.prototype=new q,f.name=f.fxid=a,c[a]=n(a,b,e);for(g in d)d.hasOwnProperty(g)&&(f[g]=d[g]);for(g in q)g!=="prototype"&&q.hasOwnProperty(g)&&(c[a][g]=q[g])}return c[a]}h.generators=c;for(b=0;b<a.length;b++)h[a[b]]=c(a[b],h[a[b]],h[a[b]].prototype)}(["Noise","Oscillator","Sampler","ADSREnvelope","StepSequencer","UIControl"]),t("wav",h.PCMData),h.version="0.6.3",h}.call(typeof exports=="undefined"?{}:this,this.window||global,Math,Object,Array);